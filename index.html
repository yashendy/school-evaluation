<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>

<script>
  const auth = firebase.auth();
  const db = firebase.firestore();

  function toggleTab(isLogin) {
    document.getElementById("login-tab").style.display = isLogin ? "block" : "none";
    document.getElementById("register-tab").style.display = isLogin ? "none" : "block";
    const btns = document.querySelectorAll('.tab-btn');
    btns[0].classList.toggle('active', isLogin);
    btns[1].classList.toggle('active', !isLogin);
  }

  document.querySelector("#login-tab .form-button").onclick = async () => {
    const email = document.querySelector("#login-tab input[type=email]").value;
    const password = document.querySelector("#login-tab input[type=password]").value;
    const role = document.querySelector("#login-tab input[name='login-type']:checked").nextSibling.textContent.trim();

    if (!email || !password) return alert("يرجى إدخال البريد وكلمة المرور");

    try {
      const userCred = await auth.signInWithEmailAndPassword(email, password);
      const userId = userCred.user.uid;
      const userDoc = await db.collection("users").doc(userId).get();
      const userData = userDoc.data();

      if (!userData) return alert("لا توجد بيانات لهذا المستخدم.");

      if (userData.type === 'معلم' && role === 'معلم') {
        location.href = "teacher.html";
      } else if (userData.type === 'طالب' && role === 'طالب') {
        location.href = "student.html";
      } else {
        alert("دور المستخدم لا يتطابق مع نوع الحساب.");
      }
    } catch (err) {
      alert("خطأ في تسجيل الدخول: " + err.message);
    }
  };
</script>
